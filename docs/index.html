---

title: Antibiogram Composite Images  


keywords: fastai
sidebar: home_sidebar

summary: "Building composite images"
description: "Building composite images"
nb_path: "index.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: index.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>A project with a start up in the micro-biology industry led me to write
some simple form of tooling to automate the production of composite images.  Image compositing is often used to combine related visual elements such as form, shape, color, pattern, or texture, from different sources of images into a single image.  In its elementary form, composite image is the result of blending two images, one on top of the other.<br></p>
<p>The one on the top is called foreground and the bottom one, the background(Figure 1).  Foreground image is smaller in sizes.  It can also be described as active, when compared to background.  The same foreground image can be used many times and allocated in different locations of the background image during production of composite images.  Background image, on the other hand, is static.  Similar to foreground, the same background image can be used many times during production of composite images, but it rarely needs any adjustment or change.<br></p>
<p>Composite images are very useful, especially when real images are in shortage.  It was ideal, in my case, for prototyping!   And also, it is cheaper and sometimes easier to obtain than real images.  Nonetheless, hardly composite images can fully substitute real images.  Probably, a combination of both would be ideal for certain scenario.<br></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li><a href="">Training Detectron2 using composite antibiogram images</a> (Under construction!)<br></li>
<li><p>Compositing images methods and utility functions:<br> 
<strong>Sample_nb_1.ipynb</strong><br>
<a href="https://colab.research.google.com/github/chho-work/syntheticReplica/blob/main/sample_nbs/Sample_nb_1.ipynb"><img src="https://colab.research.google.com/assets/colab-badge.svg" alt="Open In Colab"></a></p>
<p><strong>Sample_nb_2.ipynb</strong><br>
<a href="https://colab.research.google.com/github/chho-work/syntheticReplica/blob/main/sample_nbs/Sample_nb_2.ipynb"><img src="https://colab.research.google.com/assets/colab-badge.svg" alt="Open In Colab"></a></p>
</li>
<li><a href="">What is "antibiogram"?</a> (Under construction!)<br></li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Real-vs-Composite-Images">Real vs Composite Images<a class="anchor-link" href="#Real-vs-Composite-Images"> </a></h2><blockquote><p>Sample of composite images of antibiograms</p>
</blockquote>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<img src="https://github.com/chho-work/syntheticReplica/blob/main/assets/real_composite.jpg?raw=True"/>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Building-Composite-Images-in-Practice">Building Composite Images in Practice<a class="anchor-link" href="#Building-Composite-Images-in-Practice"> </a></h2><blockquote><p>Bottlenecks when making composite images</p>
</blockquote>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>When creating composite images, I found that it was often the case that I wanted to have the flexibility to choose the number of foreground images. To paste a single  image, I first needed to find a coordinate, the location in the background image.  And obviously,  for each additional image that I choose to paste, more coordinates were required. Time spent generating coordinates soon increased exponentially and it became cumbersome as I built more composite images.   Ideally, this process should be automated.<br></p>
<p>Initially, I wrote a script to generate random coordinates.  Each random output(coordinates) was randomly selected from coordinates of the background image. In another words, the total possible number of coordinates is equal to image width multiplied by image height.<br></p>
<p>However, after generating some random coordinates, I realized that this wasn’t going be feasible as some generated coordinates were too close to each other leading foreground images to overlap.  In addition, some few generated coordinates were located out of the petri dish.  Creating a synthetic image with disks and zone of inhibition outside of a petri dish would be out of context and inconsistent with real images(Figure 2).<br></p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<img src="https://github.com/chho-work/syntheticReplica/blob/main/assets/composite_image_explain.jpg?raw=True"/>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Positioning-Foreground-Images">Positioning Foreground Images<a class="anchor-link" href="#Positioning-Foreground-Images"> </a></h2><blockquote><p>The solution, decide in advance the location to paste foreground images</p>
</blockquote>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>After few more tests, it became clear to me that to solve the above constraints, for each composite image I needed to generate random coordinates that falls within a smaller boundary(range), rather than the image size range.  The boundary would first, limit the locations in which each image would appear and avoid image overlap when it happens. Second, it restricts the areas in which each disk and zone of inhibition would appear, it would locate them inside of the petri dish, making the synthetic image more realistic.<br></p>
<p>The illustration below depicts the idea.  In this example, there are two boundaries(B1, B2), each for a different foreground image.  Each boundary is limited by the size of horizontal(expand_x) and a vertical(expand_y) lines.  The size of each line is the range of possible coordinates.  The coordinate to paste the foreground image in boundary B1 will be selected randomly from the sequence of coordinates under list B1. And same applies to B2 boundary.<br></p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<img src="https://github.com/chho-work/syntheticReplica/blob/main/assets/positioning.jpg?raw=True"/>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Try-It-in-Google-Colab!">Try It in Google Colab!<a class="anchor-link" href="#Try-It-in-Google-Colab!"> </a></h2><p><strong>Sample_nb_2.ipynb</strong><br>
<a href="https://colab.research.google.com/github/chho-work/syntheticReplica/blob/main/sample_nbs/Sample_nb_2.ipynb"><img src="https://colab.research.google.com/assets/colab-badge.svg" alt="Open In Colab"></a></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Position each foreground image:</p>
<ul>
<li>To create a new position, create a new name for "index" and add input new coordinates for init_pro, expand_x(optional) and expand_y(optional).</li>
<li>You can view the position of each coordinate created by executing the cell.</li>
<li>To update a previously created point, change the index to the name of the point you wish to update and make the approapriate changes.    </li>
</ul>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<img src="https://github.com/chho-work/syntheticReplica/blob/main/assets/positioning_nb.jpg?raw=True"/>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Make Composite Images:</p>
<ul>
<li>"image_id" numbering must start with number 1, 2, 3, ...</li>
<li>To change the name of the file, simply change the name of "fname_train".</li>
<li>You can view the names and images for previous created composite images by pressing the numbers in the TarBar.</li>
</ul>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<img src="https://github.com/chho-work/syntheticReplica/blob/main/assets/build.jpg?raw=True"/>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

